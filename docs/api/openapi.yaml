openapi: 3.0.3

info:
  title: Transcendence API
  version: 1.0.0

tags:
  - name: Auth
  - name: Feed
  - name: Profile
  - name: Search
  - name: Notifications

paths:

  # =====================
  # AUTH
  # =====================

  /auth/login:
    post:
      tags: [Auth]
      summary: Login with email or username
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: ./auth/auth.schemas.yaml#/LoginRequest
      responses:
        "200":
          description: Login successful
          content:
            application/json:
              schema:
                $ref: ./auth/auth.envelopes.yaml#/AuthResponseEnvelope

  /auth/signup:
    post:
      tags: [Auth]
      summary: Register new user
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: ./auth/auth.schemas.yaml#/SignupRequest
      responses:
        "201":
          description: Signup successful
          content:
            application/json:
              schema:
                $ref: ./auth/auth.envelopes.yaml#/AuthResponseEnvelope

  /auth/google:
    post:
      tags: [Auth]
      summary: Login or signup via Google OAuth
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: ./auth/auth.schemas.yaml#/GoogleAuthRequest
      responses:
        "200":
          description: Auth successful
          content:
            application/json:
              schema:
                $ref: ./auth/auth.envelopes.yaml#/AuthResponseEnvelope


  # =====================
  # FEED
  # =====================

  /feed:
    get:
      tags: [Feed]
      summary: Load feed posts
      parameters:
        - name: page
          in: query
          schema:
            type: integer
            default: 1
        - name: pageSize
          in: query
          schema:
            type: integer
            default: 10
      responses:
        "200":
          description: Feed loaded
          content:
            application/json:
              schema:
                $ref: ./feed/feed.envelopes.yaml#/FeedResponseEnvelope

  /posts/{postId}:
    get:
      tags: [Feed]
      summary: Get post details
      parameters:
        - name: postId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: Post details loaded
          content:
            application/json:
              schema:
                $ref: ./feed/feed.envelopes.yaml#/PostDetailsEnvelope

  /posts/{postId}/comments:
    get:
      tags: [Feed]
      summary: Load post comments
      parameters:
        - name: postId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: Comments loaded
          content:
            application/json:
              schema:
                $ref: ./feed/feed.envelopes.yaml#/CommentsEnvelope

    post:
      tags: [Feed]
      summary: Add comment to post
      parameters:
        - name: postId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: ./feed/feed.schemas.yaml#/CreateCommentRequest
      responses:
        "201":
          description: Comment created
          content:
            application/json:
              schema:
                $ref: ./feed/feed.envelopes.yaml#/CommentEnvelope

  /posts/{postId}/like:
    post:
      tags: [Feed]
      summary: Like or unlike post
      parameters:
        - name: postId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: Like toggled
          content:
            application/json:
              schema:
                $ref: ./feed/feed.envelopes.yaml#/LikeEnvelope

  /posts/{postId}/likes:
    get:
      tags: [Feed]
      summary: Get users who liked post
      parameters:
        - name: postId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: Likes loaded
          content:
            application/json:
              schema:
                $ref: ./feed/feed.envelopes.yaml#/PostLikesEnvelope


  # =====================
  # PROFILE
  # =====================

  /profile/me:
    get:
      tags: [Profile]
      summary: Get current user profile
      responses:
        "200":
          description: Profile loaded
          content:
            application/json:
              schema:
                $ref: ./profile/profile.envelopes.yaml#/MyProfileEnvelope

    patch:
      tags: [Profile]
      summary: Update profile info
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: ./profile/profile.schemas.yaml#/UpdateProfileRequest
      responses:
        "200":
          description: Profile updated
          content:
            application/json:
              schema:
                $ref: ./profile/profile.envelopes.yaml#/ProfileUpdatedEnvelope


  /profile/me/posts:
    get:
      tags: [Profile]
      summary: Get current user posts
      responses:
        "200":
          description: Posts loaded
          content:
            application/json:
              schema:
                $ref: ./profile/profile.envelopes.yaml#/MyPostsGridEnvelope

    post:
      tags: [Profile]
      summary: Create new post
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              $ref: ./profile/profile.schemas.yaml#/CreatePostRequest
      responses:
        "201":
          description: Post created
          content:
            application/json:
              schema:
                $ref: ./profile/profile.envelopes.yaml#/PostCreatedEnvelope


  # =====================
  # SEARCH
  # =====================

  /search/users:
    get:
      tags: [Search]
      summary: Search users
      parameters:
        - name: q
          in: query
          required: true
          schema:
            type: string
            minLength: 2
      responses:
        "200":
          description: Users found
          content:
            application/json:
              schema:
                $ref: ./search/search.envelopes.yaml#/SearchUsersEnvelope


  # =====================
  # NOTIFICATIONS
  # =====================

  /notifications:
    get:
      tags: [Notifications]
      summary: Get notifications
      responses:
        "200":
          description: Notifications list
          content:
            application/json:
              schema:
                $ref: ./notifications/notifications.envelopes.yaml#/NotificationsListEnvelope

  /notifications/{notificationId}/read:
    post:
      tags: [Notifications]
      summary: Mark notification as read
      parameters:
        - name: notificationId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: Notification marked as read
          content:
            application/json:
              schema:
                $ref: ./common/ApiResponse.yaml#/ApiResponseBase

  /notifications/read-all:
    post:
      tags: [Notifications]
      summary: Mark all notifications as read
      responses:
        "200":
          description: All notifications marked as read
          content:
            application/json:
              schema:
                $ref: ./common/ApiResponse.yaml#/ApiResponseBase

  /chats:
    get:
      tags: [Chats]
      summary: Get user chat list
      responses:
        "200":
          description: Chats loaded
          content:
            application/json:
              schema:
                type: object
                required: [isSuccess, errors]
                properties:
                  isSuccess:
                    type: boolean
                  errors:
                    type: array
                    items:
                      type: string
                  data:
                    type: array
                    items:
                      $ref: ./chats/chats.schemas.yaml#/ChatListItemDto

  /chats/{chatId}/messages:
    get:
      tags: [Chats]
      summary: Get chat messages
      parameters:
        - name: chatId
          in: path
          required: true
          schema:
            type: string
            format: uuid
        - name: page
          in: query
          schema:
            type: integer
            default: 1
        - name: pageSize
          in: query
          schema:
            type: integer
            default: 20
            maximum: 50
      responses:
        "200":
          description: Messages loaded
          content:
            application/json:
              schema:
                type: object
                required: [isSuccess, errors]
                properties:
                  isSuccess:
                    type: boolean
                  errors:
                    type: array
                    items:
                      type: string
                  data:
                    type: array
                    items:
                      $ref: ./chats/chats.schemas.yaml#/MessageDto

  /chats/{chatId}/read:
    post:
      tags: [Chats]
      summary: Mark chat messages as read
      parameters:
        - name: chatId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: Messages marked as read
          content:
            application/json:
              schema:
                $ref: ./common/ApiResponse.yaml#/ApiResponseBase

  /profile/{userId}:
    get:
      tags: [Profile]
      summary: Get other user profile
      parameters:
        - name: userId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: Profile loaded
          content:
            application/json:
              schema:
                $ref: ./profile/profile.envelopes.yaml#/OtherProfileEnvelope

  /profile/{userId}/posts:
    get:
      tags: [Profile]
      summary: Get user posts
      parameters:
        - name: userId
          in: path
          required: true
          schema:
            type: string
            format: uuid
        - name: page
          in: query
          schema:
            type: integer
            default: 1
        - name: pageSize
          in: query
          schema:
            type: integer
            default: 20
            maximum: 50
      responses:
        "200":
          description: Posts loaded
          content:
            application/json:
              schema:
                $ref: ./profile/profile.envelopes.yaml#/OtherProfilePostsEnvelope

  /profile/{userId}/follow:
    post:
      tags: [Profile]
      summary: Follow or unfollow user
      parameters:
        - name: userId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: Follow state changed
          content:
            application/json:
              schema:
                $ref: ./common/ApiResponse.yaml#/ApiResponseBase

components:
  schemas:
    ApiMetadata:
      $ref: ./common/ApiResponse.yaml#/ApiMetadata

    ApiResponseBase:
      $ref: ./common/ApiResponse.yaml#/ApiResponseBase

    UserShortDto:
      $ref: ./common/user.schemas.yaml#/UserShortDto